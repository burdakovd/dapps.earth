DOCKER_COMPOSE_VERSION: 1.22.0

env:
  global:
    # TRAVIS_PASSWORD_a4a4667750982126 (to deploy .env.staging)
    - secure: "CO0Ynr1CxJCjk91/jY+NP+kTrtCeC744ePj8c6hY0zDhqmQTdKfiK7bLXPYgAZo8GFo+yHWnLrhO3YFt77Ovr1CrynRxY0FoFY+7yZi2wAD8cBptA3GwypjYP39Fhtre8QkpltAPoR2wJ5bUTvgO+STQRQ8Ab8ilZlFtTUDjNEZdsOUgRucnkKk99joeMho1Gsji2/2tqrpndAj0RSTv1P5TOkgpZd9tC9gxtRUCBrXCTDP09/shunzahOf9UPTklc6AEE9vFB9g3mi59gcWAnCsuoP0DoOf5nQzEvDYDoWbFrYGGaSIBYM7j4F/foLmcwHEYxajGwuUqe12H42iBZWQiTd/BdbTFExzC/ycAhqoiemdpF/lYtZ8rqVUw4wtgwJmZc5EPbkHoVl2pcdY0bkHr1xe4TXxCZnI7NANeJinBpcCkGWLUMXXALL3R6oZ+zeHNrQ0pXRQpxbafdJEWYnnqqGf2Sa+9HUhtA9nsl4a/Fu2mvNlaZ0vHn3Z5LBk6PAsUktNwZqHUIcyOcBa5hQ0n8Oo1nqdiDwb3A3k7OjjiQM9UO+vLz44nzrkKn5/X9x0qcYWP8lPQxa4socTN0cOMaj4cdIsXB4DoFE7MSml1TEc6139zungicbhF2y+0gFx+fTLJeLnFGHenKKoxIYf75GzyOCBgoQaM1qV28o="
    # Password to decrypt key b62b59370733a386 (prod)
    - secure: "TrMTZNyXCG3cgqv5jpqQHXCeVbN3SJD71/ZXaSTdQP58gGOt5gAlIHnGPOmNhwKKqQkwIosbkkMcWx2nj5t8WoGH6c8ZNzKQAK+E/ZYZET2V112SX72zqLF5SuKSceX+eT33lolCOyoFVreW6GkURKzDmcTpsnJ0/bUKXJpg3NI3Zfm1dQZ4o8FnjTBKp68vM1AvDCH+dPY9nTUgsS0Gi78uDgZ9Le5GaNKPVo58fa8n+tE2bD0cVFE9o1g8VEIGrsBUmrPjKnX9vlD6A3AWX9obIA6BJ2GHGIroV7sEdLax+AjRAFk+LzRocjRIG9i6+IBnoq2qMirl8yqS7dpql3boZhu362OtmJUC0GAaTVaIYDExMCYjYfs0RoU+Ypwt2sCP/+aWZTf2IjM8pX+2+qQ0HcKBQHQTRVMU0/Of9MAE7TV8Oe6ugiuFZSjQlteauk9d1xw4VpTgYVS4ng0zZs6s8TjsZ9tXvPWpyhY7Vpa0qSNCg7sNjXVdBTEMjZHnsZv67c43eZmmr2n8aSaqhUmRzpVaswkZe+qozAWo9LMxYSbIHf3klKBRGzd4YhRbkCcGdEI8dDmUI5xM9PRcHzARzpYzx7dnywwtP30dSPBtYlqrvA68kiQ+4eSitD3JUXyD0wcDfGAV4Tk0DDUwJ7wOhBwR+agGclA+pHAFWHM="

before_install:
  - sudo apt-get install jq

script:
 - docker-compose pull
 - docker-compose build

after_success:
  - if [ "$TRAVIS_BRANCH" = "master" ] && [ "$TRAVIS_PULL_REQUEST" = "false" ];
    then
      export ENV=.env.staging;
      (. $ENV && ./scripts/deploy.sh);
    fi
  - if [ "$TRAVIS_BRANCH" = "master" ] && [ "$TRAVIS_PULL_REQUEST" = "false" ];
    then
      export ENV=.env;
      (. $ENV && ./scripts/deploy.sh);
    fi
